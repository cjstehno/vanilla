<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>ZipBuilder.groovy</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">vanilla-core</a> &gt; <a href="index.source.html" class="el_package">com.stehno.vanilla.io</a> &gt; <span class="el_source">ZipBuilder.groovy</span></div><h1>ZipBuilder.groovy</h1><pre class="source lang-java linenums">/*
 * Copyright (c) 2015 Christopher J. Stehno
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package com.stehno.vanilla.io

import java.util.zip.ZipEntry
import java.util.zip.ZipOutputStream

/**
 * Uses the fluent builder pattern to build zip files.
 */
class ZipBuilder {

    private final ZipOutputStream zos

    /**
     * Creates a zip builder with the given output stream. The stream will be closed when the &lt;code&gt;zip()&lt;/code&gt;
     * method is called.
     *
     * @param os the output stream the zip file is to be written into
     */
    ZipBuilder(final OutputStream os) {
<span class="fc" id="L36">        zos = new ZipOutputStream(os)</span>
    }

    /**
     * Used to specify the the zip file should be compressed. By default no compression is performed.
     *
     * @param level the compression level, defaults to 0 - no compression
     * @return a reference to the zip builder
     */
    ZipBuilder useCompression(final int level = 0) {
<span class="fc" id="L46">        zos.method = ZipOutputStream.DEFLATED</span>
<span class="fc" id="L47">        zos.level = level</span>
<span class="pc" id="L48">        this</span>
    }

    /**
     * Used to specify a zip file level comment. This comment does not seem to be visible to the
     * Java API itself however, other applications such as WinZip do recognize it.
     *
     * @param comment the file level comment
     * @return a reference to the builder
     */
    ZipBuilder withComment(final String comment) {
<span class="fc" id="L59">        zos.comment = comment</span>
<span class="pc" id="L60">        this</span>
    }

    /**
     * Used to add an entry to the zip file.
     *
     * @param entry the zip entry to be added
     * @param bytes the data bytes of the entry data
     * @return a reference to the zip builder
     * @throws IOException if there is a problem writing the entry data
     */
    ZipBuilder addEntry(final ZipEntry entry, final byte[] bytes) throws IOException {
<span class="fc" id="L72">        zos.putNextEntry(entry)</span>
<span class="fc" id="L73">        zos.write(bytes)</span>
<span class="fc" id="L74">        zos.closeEntry()</span>
<span class="pc" id="L75">        this</span>
    }

    /**
     * 	Used to add the entry to the zip file. The data from the input stream will be read and
     * the stream will be closed by this method.
     *
     * @param entry the zip entry
     * @param in the input stream containing the data for the entry
     * @return a reference to the builder
     * @throws IOException if there is a problem writing the entry data
     */
    ZipBuilder addEntry(final ZipEntry entry, final InputStream ins) throws IOException {
<span class="fc" id="L88">        zos.putNextEntry(entry)</span>
<span class="fc" id="L89">        zos &lt;&lt; ins.bytes</span>
<span class="fc" id="L90">        zos.closeEntry()</span>
<span class="pc" id="L91">        this</span>
    }

    /**
     * Used to add an entry with the given data.
     *
     * @param name the entry name
     * @param bytes the entry data
     * @param comment the optional comment for the entry
     * @return a reference to the builder
     * @throws IOException if there is a problem writing the entry data
     */
    ZipBuilder addEntry(final String name, final byte[] bytes, final String comment = null) throws IOException {
<span class="fc" id="L104">        final ZipEntry entry = new ZipEntry(name)</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">        if (comment) {</span>
<span class="fc" id="L106">            entry.comment = comment</span>
        }
<span class="pc" id="L108">        addEntry(entry, bytes)</span>
    }

    /**
     * Used to add an entry to the zip file. The input stream will be read and closed by this method.
     *
     * @param name the entry name
     * @param in the input stream containing the entry data
     * @param comment the optional comment for the entry
     * @return a reference to the builder
     * @throws IOException if there is a problem writing the entry data
     */
    ZipBuilder addEntry(final String name, final InputStream ins, final String comment = null) throws IOException {
<span class="fc" id="L121">        final ZipEntry entry = new ZipEntry(name)</span>
<span class="fc bfc" id="L122" title="All 2 branches covered.">        if (comment) {</span>
<span class="fc" id="L123">            entry.comment = comment</span>
        }
<span class="pc" id="L125">        addEntry(entry, ins)</span>
    }

    /**
     * 	Used to finish writing the zip file and close out the builder.
     *
     * @throws IOException if there is a problem writing the zip file
     */
    void zip() throws IOException {
        try {
<span class="fc" id="L135">            zos.finish()</span>
        }
        finally {
<span class="pc" id="L138">            zos?.close()</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>